(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1ead"],{1807:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{width:"100%",height:"100%"}},[i("Tabs",{attrs:{type:"card"},on:{"on-click":e.tabChange}},[i("TabPane",{attrs:{label:"电影"}}),i("TabPane",{attrs:{label:"电视剧"}}),i("TabPane",{attrs:{label:"综艺"}}),i("TabPane",{attrs:{label:"动漫"}}),i("TabPane",{attrs:{label:"纪录片"}})],1),i("Dropdown",{ref:"menu",attrs:{trigger:"contextMenu",placement:"right"},on:{"on-click":e.rightMenuClick}},[i("dropdown-menu",{attrs:{slot:"list"},slot:"list"},[i("dropdown-item",{attrs:{name:"addNode"}},[e._v("添加子标签")]),"category"!=e.nodeType?i("dropdown-item",{attrs:{name:"synonym"}},[e._v("同义词")]):e._e(),"category"!=e.nodeType?i("dropdown-item",{attrs:{name:"upNode"}},[e._v("修改标签")]):e._e(),"category"!=e.nodeType?i("dropdown-item",{attrs:{name:"delNode"}},[e._v("删除标签")]):e._e()],1)],1),i("div",{attrs:{id:"jsmind_container"},on:{contextmenu:function(t){return t.preventDefault(),e.rightClick(t)},click:e.leftClick}},[i("Drawer",{attrs:{title:"top排行",closable:!1,width:"600"},model:{value:e.value1,callback:function(t){e.value1=t},expression:"value1"}},[i("div",{staticStyle:{float:"right"}},[i("Button",{attrs:{type:"primary"},on:{click:e.modalDetailsBtn}},[e._v("修改top榜")]),i("Modal",{attrs:{title:"top榜",width:"1100"},model:{value:e.modalDetails,callback:function(t){e.modalDetails=t},expression:"modalDetails"}},[i("Form",{attrs:{model:e.news,inline:""}},[i("FormItem",{attrs:{label:"标签:","label-width":40}},[i("Input",{staticStyle:{width:"200px"},attrs:{disabled:""},model:{value:e.news.tag_id,callback:function(t){e.$set(e.news,"tag_id",t)},expression:"news.tag_id"}})],1)],1),i("div",{staticStyle:{float:"left"}},[i("Form",{attrs:{model:e.search,inline:""}},[i("FormItem",{attrs:{label:"节目名称:","label-width":70}},[i("Input",{attrs:{placeholder:"请输入节目名称..."},model:{value:e.search.title,callback:function(t){e.$set(e.search,"title",t)},expression:"search.title"}})],1),i("FormItem",{attrs:{label:"年代:","label-width":50}},[i("Input",{attrs:{placeholder:"请输入年代..."},model:{value:e.search.year,callback:function(t){e.$set(e.search,"year",t)},expression:"search.year"}})],1),i("FormItem",{attrs:{label:"是否关联媒资:","label-width":100}},[i("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择是否关联媒资..."},model:{value:e.search.is_relation,callback:function(t){e.$set(e.search,"is_relation",t)},expression:"search.is_relation"}},[i("Option",{attrs:{value:""}},[e._v("全部")]),i("Option",{attrs:{value:1}},[e._v("是")]),i("Option",{attrs:{value:2}},[e._v("否")])],1)],1),i("FormItem",[i("Button",{attrs:{type:"primary"},on:{click:e.query}},[e._v("搜索")])],1)],1)],1),i("div",{staticStyle:{float:"right"}},[i("Button",{attrs:{type:"success"},on:{click:e.showModalAdd}},[e._v("添加")]),i("Modal",{attrs:{title:"添加"},on:{"on-ok":e.okAdd},model:{value:e.modalAdd,callback:function(t){e.modalAdd=t},expression:"modalAdd"}},[i("Form",{attrs:{model:e.info,"label-position":"right","label-width":100}},[i("FormItem",{attrs:{label:"标签:"}},[i("Input",{attrs:{disabled:""},model:{value:e.info.tag_name,callback:function(t){e.$set(e.info,"tag_name",t)},expression:"info.tag_name"}})],1),i("FormItem",{attrs:{label:"节目分类:"}},[i("Input",{attrs:{disabled:""},model:{value:e.info.category_name,callback:function(t){e.$set(e.info,"category_name",t)},expression:"info.category_name"}})],1),i("FormItem",{attrs:{label:"节目名称:"}},[i("Input",{attrs:{placeholder:"请输入节目名称..."},model:{value:e.info.title,callback:function(t){e.$set(e.info,"title",t)},expression:"info.title"}})],1),i("FormItem",{attrs:{label:"导演:"}},[i("Input",{attrs:{placeholder:"请输入导演..."},model:{value:e.info.director,callback:function(t){e.$set(e.info,"director",t)},expression:"info.director"}})],1),i("FormItem",{attrs:{label:"年代:"}},[i("Input",{attrs:{placeholder:"请输入年代..."},model:{value:e.info.year,callback:function(t){e.$set(e.info,"year",t)},expression:"info.year"}})],1),i("FormItem",{attrs:{label:"排序:"}},[i("Input",{attrs:{placeholder:"请输入排序..."},model:{value:e.info.sort,callback:function(t){e.$set(e.info,"sort",t)},expression:"info.sort"}})],1),i("FormItem",{attrs:{label:"关联媒资信息:",inline:""}},[i("Input",{staticStyle:{float:"left"},model:{value:e.info.media_name,callback:function(t){e.$set(e.info,"media_name",t)},expression:"info.media_name"}}),i("Button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.modalChange=!0,e.getProductList()}}},[e._v("修改")]),i("Modal",{attrs:{title:"媒资信息",width:"600"},on:{"on-ok":e.okProgramOne},model:{value:e.modalChange,callback:function(t){e.modalChange=t},expression:"modalChange"}},[i("Table",{attrs:{border:"",columns:e.columns3,data:e.data3,"highlight-row":!0},on:{"on-row-click":e.programOne}})],1)],1)],1)],1)],1),i("Modal",{attrs:{title:"修改"},on:{"on-ok":e.okEdit},model:{value:e.modalEdit,callback:function(t){e.modalEdit=t},expression:"modalEdit"}},[i("Form",{attrs:{model:e.edit,"label-position":"right","label-width":100}},[i("FormItem",{attrs:{label:"标签:"}},[i("Input",{attrs:{disabled:""},model:{value:e.edit.tag_name,callback:function(t){e.$set(e.edit,"tag_name",t)},expression:"edit.tag_name"}})],1),i("FormItem",{attrs:{label:"节目分类:"}},[i("Input",{attrs:{disabled:""},model:{value:e.edit.category_name,callback:function(t){e.$set(e.edit,"category_name",t)},expression:"edit.category_name"}})],1),i("FormItem",{attrs:{label:"节目名称:"}},[i("Input",{attrs:{placeholder:"请输入节目名称..."},model:{value:e.edit.title,callback:function(t){e.$set(e.edit,"title",t)},expression:"edit.title"}})],1),i("FormItem",{attrs:{label:"导演:"}},[i("Input",{attrs:{placeholder:"请输入导演..."},model:{value:e.edit.director,callback:function(t){e.$set(e.edit,"director",t)},expression:"edit.director"}})],1),i("FormItem",{attrs:{label:"年代:"}},[i("Input",{attrs:{placeholder:"请输入年代..."},model:{value:e.edit.year,callback:function(t){e.$set(e.edit,"year",t)},expression:"edit.year"}})],1),i("FormItem",{attrs:{label:"排序:"}},[i("Input",{attrs:{placeholder:"请输入排序..."},model:{value:e.edit.sort,callback:function(t){e.$set(e.edit,"sort",t)},expression:"edit.sort"}})],1),i("FormItem",{attrs:{label:"关联媒资信息:",inline:""}},[i("Input",{staticStyle:{float:"left"},model:{value:e.edit.media_name,callback:function(t){e.$set(e.edit,"media_name",t)},expression:"edit.media_name"}}),i("Button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.modalChange=!0,e.getProductList()}}},[e._v("修改")]),i("Modal",{attrs:{title:"媒资信息",width:"600"},on:{"on-ok":e.okProgramOne},model:{value:e.modalChange,callback:function(t){e.modalChange=t},expression:"modalChange"}},[i("div",[i("Form",{attrs:{model:e.searchProgram,inline:""}},[i("FormItem",{attrs:{label:"节目名称:","label-width":70}},[i("Input",{attrs:{placeholder:"请输入节目名称..."},model:{value:e.searchProgram.title,callback:function(t){e.$set(e.searchProgram,"title",t)},expression:"searchProgram.title"}})],1),i("FormItem",{attrs:{label:"导演:","label-width":40}},[i("Input",{attrs:{placeholder:"请输入导演..."},model:{value:e.searchProgram.directors,callback:function(t){e.$set(e.searchProgram,"directors",t)},expression:"searchProgram.directors"}})],1),i("FormItem",[i("Button",{attrs:{type:"primary"},on:{click:e.queryProgram}},[e._v("搜索")])],1)],1)],1),i("Table",{attrs:{border:"",columns:e.columns3,data:e.data3,"highlight-row":!0},on:{"on-row-click":e.programOne}}),i("div",{staticStyle:{float:"right","margin-top":"10px"}},[i("Page",{attrs:{total:e.total,current:e.page,"page-size":e.pageSize,"show-elevator":""},on:{"on-change":e.changePage}})],1),i("div",{staticStyle:{"margin-top":"30px",clear:"both"}})],1)],1)],1)],1),i("div",{staticStyle:{clear:"both"}}),i("div",[i("Table",{attrs:{border:"",columns:e.columns2,data:e.data2}})],1)],1)],1),i("div",{staticStyle:{clear:"both"}}),i("div",{staticStyle:{"margin-top":"10px"}},[i("Table",{attrs:{border:"",columns:e.columns1,data:e.data1}})],1)])],1),i("Modal",{attrs:{title:"添加子标签"},on:{"on-ok":e.okAddNode},model:{value:e.addNodeModel,callback:function(t){e.addNodeModel=t},expression:"addNodeModel"}},[i("Form",{attrs:{model:e.addNodeInfo,"label-position":"right","label-width":100}},[i("FormItem",{attrs:{label:"标签名称:"}},[i("Input",{attrs:{placeholder:"请输入标签名称..."},model:{value:e.addNodeInfo.name,callback:function(t){e.$set(e.addNodeInfo,"name",t)},expression:"addNodeInfo.name"}})],1),i("FormItem",{attrs:{label:"上级标签:"}},[i("Input",{attrs:{readonly:""},model:{value:e.addNodeInfo.parent,callback:function(t){e.$set(e.addNodeInfo,"parent",t)},expression:"addNodeInfo.parent"}})],1),i("FormItem",{attrs:{label:"标签描述:"}},[i("Input",{attrs:{type:"textarea",rows:4,placeholder:"请输入标签描述..."},model:{value:e.addNodeInfo.desc,callback:function(t){e.$set(e.addNodeInfo,"desc",t)},expression:"addNodeInfo.desc"}})],1)],1)],1),i("Modal",{attrs:{title:"修改同义词"},on:{"on-ok":e.okSynonym},model:{value:e.synonymModel,callback:function(t){e.synonymModel=t},expression:"synonymModel"}},[i("Form",{attrs:{model:e.synonymEdit,"label-position":"right","label-width":100}},[i("FormItem",{attrs:{label:"标签名称:"}},[i("Input",{attrs:{placeholder:"请输入标签名称...",disabled:""},model:{value:e.synonymEdit.name,callback:function(t){e.$set(e.synonymEdit,"name",t)},expression:"synonymEdit.name"}})],1),i("FormItem",{attrs:{label:"同义词:"}},[i("Input",{attrs:{type:"textarea",rows:4,placeholder:"请输入同义词..."},model:{value:e.synonymEdit.tag_alias,callback:function(t){e.$set(e.synonymEdit,"tag_alias",t)},expression:"synonymEdit.tag_alias"}})],1)],1)],1),i("Modal",{attrs:{title:"修改标签"},on:{"on-ok":e.okUpNode},model:{value:e.upNodeModel,callback:function(t){e.upNodeModel=t},expression:"upNodeModel"}},[i("Form",{attrs:{model:e.upNodeEdit,"label-position":"right","label-width":100}},[i("FormItem",{attrs:{label:"标签名称:"}},[i("Input",{model:{value:e.upNodeEdit.name,callback:function(t){e.$set(e.upNodeEdit,"name",t)},expression:"upNodeEdit.name"}})],1),i("FormItem",{attrs:{label:"上级标签:"}},[i("Input",{attrs:{readonly:""},model:{value:e.upNodeEdit.parent,callback:function(t){e.$set(e.upNodeEdit,"parent",t)},expression:"upNodeEdit.parent"}})],1),i("FormItem",{attrs:{label:"标签描述:"}},[i("Input",{attrs:{type:"textarea",rows:4},model:{value:e.upNodeEdit.desc,callback:function(t){e.$set(e.upNodeEdit,"desc",t)},expression:"upNodeEdit.desc"}})],1)],1)],1)],1)},o=[],a=(i("386d"),i("ac6a"),i("7f7f"),i("6e2c"),i("6376")),d=i.n(a),r={data:function(){var e=this;return{addNodeModel:!1,addNodeInfo:{},synonymModel:!1,synonymEdit:{},upNodeModel:!1,upNodeEdit:{},tabId:1,tabName:"",nodeType:"",selectdNode:null,aaa:null,total:0,page:1,pageSize:10,programOneRow:{},news:{tag_id:""},search:{title:"",year:"",is_relation:""},searchProgram:{title:"",directors:""},modalDetails:!1,info:{},modalAdd:!1,modalChange:!1,edit:{},modalEdit:!1,jm:{},value1:!1,mind:{meta:{name:"test",author:"vivi",version:"v1.0.0"},format:"node_tree",data:{id:"root",topic:"电影",children:[]}},options:{container:"jsmind_container",theme:"orange",editable:!0,default_event_handle:{enable_dblclick_handle:!1}},columns1:[{title:"节目名称",key:"title",align:"center",width:130},{title:"导演",key:"director",align:"center"},{title:"上映年代",key:"year",align:"center"},{title:"关联媒资",key:"is_is_relation",align:"center"}],data1:[],columns2:[{title:"序号",type:"index",width:70,align:"center"},{title:"节目名称",key:"title",align:"center",width:130},{title:"排序ID",key:"sort",align:"center"},{title:"导演",key:"director",align:"center"},{title:"上映年代",key:"year",align:"center"},{title:"关联媒资",key:"is_is_relation",align:"center"},{title:"操作",align:"center",render:function(t,i){return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.modify(i.row)}}},"修改"),t("Poptip",{props:{confirm:!0,title:"确定要删除吗！",type:"error",size:"small",width:"150"},style:{marginRight:"5px"},on:{"on-ok":function(){e.remove(i.row)}}},[t("Button",{props:{type:"error",size:"small"}},"删除")])])}}],data2:[],columns3:[{title:"序号",type:"index",width:70,align:"center"},{title:"节目名称",key:"title",align:"center",width:130},{title:"导演",key:"directors",align:"center"},{title:"年代",key:"publish_year",align:"center"},{title:"语言",key:"language",align:"center"}],data3:[]}},methods:{tabChange:function(e){var t=this;0==e?(t.tabId=1,t.tabName="电影"):1==e?(t.tabId=2,t.tabName="电视剧"):2==e?(t.tabId=6,t.tabName="综艺"):3==e?(t.tabId=4,t.tabName="动漫"):4==e&&(t.tabId=3,t.tabName="纪录片"),this.getjsMindList()},rightClick:function(e){var t=this.jm.get_selected_node();t&&(console.log(t),console.log(e),this.nodeType=t.data.type,this.$refs.menu.$refs.reference=e.target,this.$refs.menu.currentVisible=!0)},rightMenuClick:function(e){var t=this.jm.get_selected_node();if(t)switch(this.selectdNode=t,e){case"addNode":this.addNodeModel=!0,this.addNode();break;case"synonym":this.synonymModel=!0,this.synonym();break;case"upNode":this.upNodeModel=!0,this.upNode();break;case"delNode":this.delNode();break;default:break}},addNode:function(){this.addNodeInfo={name:"",parent:this.selectdNode.topic,desc:""},console.log(this.selectdNode)},synonym:function(){this.synonymEdit={tag_id:this.selectdNode.data.aid,name:this.selectdNode.topic,tag_alias:""},console.log(this.selectdNode)},upNode:function(){this.upNodeEdit={name:this.selectdNode.topic,desc:this.selectdNode.data.desc,cid:this.selectdNode.data.cid,parrent_id:this.selectdNode.data.parrent_id,id:this.selectdNode.data.aid,parent:this.selectdNode.parent.topic},console.log(this.selectdNode)},okAddNode:function(){var e=this;""!=this.addNodeInfo.name?(this.addNodeInfo.cid=this.selectdNode.data.cid,this.addNodeInfo.parrent_id=this.selectdNode.data.aid,this.$http.post(this.$config.BaseURL7+"/media/v2/xstag/modify",this.addNodeInfo).then(function(t){1e4==t.data.errno&&(e.getjsMindList(),e.$Message.success("添加成功！"))})):this.$Message.info("节点名不能为空")},okSynonym:function(){var e=this;this.$http.post(this.$config.BaseURL7+"/media/v2/xstag/synonym",this.synonymEdit).then(function(t){1e4==t.data.errno&&(e.getjsMindList(),e.$Message.success("修改成功！"))})},okUpNode:function(){var e=this;this.$http.post(this.$config.BaseURL7+"/media/v2/xstag/modify",this.upNodeEdit).then(function(t){1e4==t.data.errno&&(e.getjsMindList(),e.$Message.success("修改成功！"))})},getjsMindList:function(){var e=this,t=this;t.$http(this.$config.BaseURL7+"/media/v2/xstag/list?category_id="+t.tabId).then(function(i){1e4==i.data.errno&&(console.log(i),t.mind.data=i.data.data[0],console.log(t.mind.data.children),e.mind.data.children.forEach(function(t,i){t.direction=i%2==0?"right":"left",e.mind.data.children[i]=t}),e.jm.show(e.mind))})},delNode:function(){var e=this;this.$http.post(this.$config.BaseURL7+"/media/v2/xstag/delete",{id:this.selectdNode.data.aid}).then(function(t){1e4==t.data.errno&&(e.getjsMindList(),e.$Message.success("删除成功！"))})},leftClick:function(){var e=this.jm.get_selected_node();e&&e.data.aid&&(this.aaa=e,this.getTableList(),console.log(this.aaa),this.value1=!0)},getTableList:function(){var e=this;void 0==this.search.status&&(this.search.status=""),this.$http(this.$config.BaseURL7+"/media/v2/xstag/toplist?tag_id="+this.aaa.data.aid+"&title="+this.search.title+"&year="+this.search.year+"&is_relation="+this.search.is_relation).then(function(t){1e4==t.data.errno&&(console.log(t),e.data1=t.data.data.list,e.data2=t.data.data.list,t.data.data.list.forEach(function(e){1==e.is_relation?e.is_is_relation="是":2==e.is_relation&&(e.is_is_relation="否")}))})},query:function(){this.getTableList()},modalDetailsBtn:function(){this.news.tag_id=this.aaa.topic,console.log(this.news),this.modalDetails=!0},getProductList:function(){var e=this;console.log(this.tabId),this.$http(this.$config.BaseURL1+"/media/v2/complete/program/list?title="+this.searchProgram.title+"&directors="+this.searchProgram.directors+"&page="+this.page+"&pageSize="+this.pageSize+"&categoryId="+this.tabId).then(function(t){1e4==t.data.errno&&(console.log(t),e.data3=t.data.data.list,e.total=t.data.data.total)})},queryProgram:function(){this.page=1,this.getProductList()},changePage:function(e){this.page=e,this.getProductList()},programOne:function(e,t){console.log(e),this.programOneRow=e},okProgramOne:function(){this.info.media_name=this.programOneRow.title,this.info.media_id=this.programOneRow.id,this.edit.media_name=this.programOneRow.title,this.edit.media_id=this.programOneRow.id},okAdd:function(){var e=this;0==this.info.media_id?this.info.is_relation=2:this.info.is_relation=1,this.info.year*=1,this.info.sort*=1,this.$http.post(this.$config.BaseURL7+"/media/v2/xstag/topmodify",this.info).then(function(t){1e4==t.data.errno&&(e.info={},e.getTableList(),e.$Message.success("添加成功！"))})},modify:function(e){console.log(e),this.edit=e,this.modalEdit=!0,this.edit.tag_id=this.aaa.data.aid,this.edit.tag_name=this.aaa.topic,this.edit.category_id=this.tabId,this.edit.category_name=this.tabName},okEdit:function(){var e=this;0==this.edit.media_id?this.edit.is_relation=2:this.edit.is_relation=1,this.$http.post(this.$config.BaseURL7+"/media/v2/xstag/topmodify",this.edit).then(function(t){1e4==t.data.errno&&(e.getTableList(),e.$Message.success("修改成功！"))})},remove:function(e){var t=this;this.$http.post(this.$config.BaseURL7+"/media/v2/xstag/topdelete",{id:e.id}).then(function(e){1e4==e.data.errno&&(t.getTableList(),t.$Message.success("删除成功！"))})},showModalAdd:function(){this.modalAdd=!0,this.info.media_id=0,this.info.tag_id=this.aaa.data.aid,this.info.tag_name=this.aaa.topic,this.info.category_id=this.tabId,this.info.category_name=this.tabName}},mounted:function(){this.jm=new d.a(this.options),this.getjsMindList()}},s=r,l=(i("7652"),i("2877")),h=Object(l["a"])(s,n,o,!1,null,"232bc858",null);h.options.__file="xstaga.vue";t["default"]=h.exports},"386d":function(e,t,i){i("214f")("search",1,function(e,t,i){return[function(i){"use strict";var n=e(this),o=void 0==i?void 0:i[t];return void 0!==o?o.call(i,n):new RegExp(i)[t](String(n))},i]})},6376:function(e,t,i){(function(t){(function(t){"use strict";var i="jsMind",n="0.4.6",o="hizzgdev@163.com",a=function(){},d="undefined"===typeof console?{log:a,debug:a,error:a,warn:a,info:a}:console;if("undefined"!==typeof e&&e.exports||"undefined"==typeof t[i]){var r=t.document,s=function(e){return r.getElementById(e)},l=function(e){return r.createElement(e)},h=function(e,t){e.hasChildNodes()?e.firstChild.nodeValue=t:e.appendChild(r.createTextNode(t))},c=function(e,t){e.innerHTML=t},u=function(e){return!!e&&"object"===typeof e&&1===e.nodeType&&"object"===typeof e.style&&"object"===typeof e.ownerDocument};"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e});var _={container:"",editable:!1,theme:null,mode:"full",support_html:!0,view:{hmargin:100,vmargin:50,line_width:2,line_color:"#555"},layout:{hspace:30,vspace:20,pspace:13},default_event_handle:{enable_mousedown_handle:!0,enable_click_handle:!0,enable_dblclick_handle:!0},shortcut:{enable:!0,handles:{},mapping:{addchild:45,addbrother:13,editnode:113,delnode:46,toggle:32,left:37,up:38,right:39,down:40}}},f=function(e){f.current=this,this.version=n;var t={};f.util.json.merge(t,_),f.util.json.merge(t,e),t.container?(this.options=t,this.inited=!1,this.mind=null,this.event_handles=[],this.init()):d.error("the options.container should not be null or empty.")};f.direction={left:-1,center:0,right:1},f.event_type={show:1,resize:2,edit:3,select:4},f.node=function(e,t,i,n,o,a,r,s){e?"number"==typeof t?("undefined"===typeof s&&(s=!0),this.id=e,this.index=t,this.topic=i,this.data=n||{},this.isroot=o,this.parent=a,this.direction=r,this.expanded=!!s,this.children=[],this._data={}):d.error("invalid node index"):d.error("invalid nodeid")},f.node.compare=function(e,t){var i=0,n=e.index,o=t.index;return i=n>=0&&o>=0?n-o:-1==n&&-1==o?0:-1==n?1:-1==o?-1:0,i},f.node.inherited=function(e,t){if(e&&t){if(e.id===t.id)return!0;if(e.isroot)return!0;var i=e.id,n=t;while(!n.isroot)if(n=n.parent,n.id===i)return!0}return!1},f.node.prototype={get_location:function(){var e=this._data.view;return{x:e.abs_x,y:e.abs_y}},get_size:function(){var e=this._data.view;return{w:e.width,h:e.height}}},f.mind=function(){this.name=null,this.author=null,this.version=null,this.root=null,this.selected=null,this.nodes={}},f.mind.prototype={get_node:function(e){return e in this.nodes?this.nodes[e]:(d.warn("the node[id="+e+"] can not be found"),null)},set_root:function(e,t,i){null==this.root?(this.root=new f.node(e,0,t,i,!0),this._put_node(this.root)):d.error("root node is already exist")},add_node:function(e,t,i,n,o,a,r){if(!f.util.is_node(e)){var s=this.get_node(e);return s?this.add_node(s,t,i,n,o,a,r):(d.error("the parent_node[id="+e+"] can not be found."),null)}var l=o||-1,h=null;if(e.isroot){var c=f.direction.right;if(isNaN(a)){for(var u=e.children,_=u.length,p=0,m=0;m<_;m++)u[m].direction===f.direction.left?p--:p++;c=_>1&&p>0?f.direction.left:f.direction.right}else c=a!=f.direction.left?f.direction.right:f.direction.left;h=new f.node(t,l,i,n,!1,e,c,r)}else h=new f.node(t,l,i,n,!1,e,e.direction,r);return this._put_node(h)?(e.children.push(h),this._reindex(e)):(d.error("fail, the nodeid '"+h.id+"' has been already exist."),h=null),h},insert_node_before:function(e,t,i,n){if(!f.util.is_node(e)){var o=this.get_node(e);return o?this.insert_node_before(o,t,i,n):(d.error("the node_before[id="+e+"] can not be found."),null)}var a=e.index-.5;return this.add_node(e.parent,t,i,n,a)},get_node_before:function(e){if(!f.util.is_node(e)){var t=this.get_node(e);return t?this.get_node_before(t):(d.error("the node[id="+e+"] can not be found."),null)}if(e.isroot)return null;var i=e.index-2;return i>=0?e.parent.children[i]:null},insert_node_after:function(e,t,i,n){if(!f.util.is_node(e)){var o=this.get_node(node_before);return o?this.insert_node_after(o,t,i,n):(d.error("the node_after[id="+e+"] can not be found."),null)}var a=e.index+.5;return this.add_node(e.parent,t,i,n,a)},get_node_after:function(e){if(!f.util.is_node(e)){var t=this.get_node(e);return t?this.get_node_after(t):(d.error("the node[id="+e+"] can not be found."),null)}if(e.isroot)return null;var i=e.index,n=e.parent.children;return n.length>=i?e.parent.children[i]:null},move_node:function(e,t,i,n){if(!f.util.is_node(e)){var o=this.get_node(e);return o?this.move_node(o,t,i,n):(d.error("the node[id="+e+"] can not be found."),null)}return i||(i=e.parent.id),this._move_node(e,t,i,n)},_flow_node_direction:function(e,t){"undefined"===typeof t?t=e.direction:e.direction=t;var i=e.children.length;while(i--)this._flow_node_direction(e.children[i],t)},_move_node_internal:function(e,t){if(e&&t)if("_last_"==t)e.index=-1,this._reindex(e.parent);else if("_first_"==t)e.index=0,this._reindex(e.parent);else{var i=t?this.get_node(t):null;null!=i&&null!=i.parent&&i.parent.id==e.parent.id&&(e.index=i.index-.5,this._reindex(e.parent))}return e},_move_node:function(e,t,i,n){if(e&&i){if(e.parent.id!=i){var o=e.parent.children,a=o.length;while(a--)if(o[a].id==e.id){o.splice(a,1);break}e.parent=this.get_node(i),e.parent.children.push(e)}e.parent.isroot?n==jsMind.direction.left?e.direction=n:e.direction=f.direction.right:e.direction=e.parent.direction,this._move_node_internal(e,t),this._flow_node_direction(e)}return e},remove_node:function(e){if(!f.util.is_node(e)){var t=this.get_node(e);return t?this.remove_node(t):(d.error("the node[id="+e+"] can not be found."),!1)}if(!e)return d.error("fail, the node can not be found"),!1;if(e.isroot)return d.error("fail, can not remove root node"),!1;null!=this.selected&&this.selected.id==e.id&&(this.selected=null);var i=e.children,n=i.length;while(n--)this.remove_node(i[n]);i.length=0;var o=e.parent.children,a=o.length;while(a--)if(o[a].id==e.id){o.splice(a,1);break}for(var r in delete this.nodes[e.id],e)delete e[r];return e=null,!0},_put_node:function(e){return e.id in this.nodes?(d.warn("the nodeid '"+e.id+"' has been already exist."),!1):(this.nodes[e.id]=e,!0)},_reindex:function(e){if(e instanceof f.node){e.children.sort(f.node.compare);for(var t=0;t<e.children.length;t++)e.children[t].index=t+1}}},f.format={node_tree:{example:{meta:{name:i,author:o,version:n},format:"node_tree",data:{id:"root",topic:"jsMind Example"}},get_mind:function(e){var t=f.format.node_tree,i=new f.mind;return i.name=e.meta.name,i.author=e.meta.author,i.version=e.meta.version,t._parse(i,e.data),i},get_data:function(e){var t=f.format.node_tree,i={};return i.meta={name:e.name,author:e.author,version:e.version},i.format="node_tree",i.data=t._buildnode(e.root),i},_parse:function(e,t){var i=f.format.node_tree,n=i._extract_data(t);if(e.set_root(t.id,t.topic,n),"children"in t)for(var o=t.children,a=0;a<o.length;a++)i._extract_subnode(e,e.root,o[a])},_extract_data:function(e){var t={};for(var i in e)"id"!=i&&"topic"!=i&&"children"!=i&&"direction"!=i&&"expanded"!=i&&(t[i]=e[i]);return t},_extract_subnode:function(e,t,i){var n=f.format.node_tree,o=n._extract_data(i),a=null;t.isroot&&(a="left"==i.direction?f.direction.left:f.direction.right);var d=e.add_node(t,i.id,i.topic,o,null,a,i.expanded);if("children"in i)for(var r=i.children,s=0;s<r.length;s++)n._extract_subnode(e,d,r[s])},_buildnode:function(e){var t=f.format.node_tree;if(e instanceof f.node){var i={id:e.id,topic:e.topic,expanded:e.expanded};if(e.parent&&e.parent.isroot&&(i.direction=e.direction==f.direction.left?"left":"right"),null!=e.data){var n=e.data;for(var o in n)i[o]=n[o]}var a=e.children;if(a.length>0){i.children=[];for(var d=0;d<a.length;d++)i.children.push(t._buildnode(a[d]))}return i}}},node_array:{example:{meta:{name:i,author:o,version:n},format:"node_array",data:[{id:"root",topic:"jsMind Example",isroot:!0}]},get_mind:function(e){var t=f.format.node_array,i=new f.mind;return i.name=e.meta.name,i.author=e.meta.author,i.version=e.meta.version,t._parse(i,e.data),i},get_data:function(e){var t=f.format.node_array,i={};return i.meta={name:e.name,author:e.author,version:e.version},i.format="node_array",i.data=[],t._array(e,i.data),i},_parse:function(e,t){var i=f.format.node_array,n=t.slice(0);n.reverse();var o=i._extract_root(e,n);o?i._extract_subnode(e,o,n):d.error("root node can not be found")},_extract_root:function(e,t){var i=f.format.node_array,n=t.length;while(n--)if("isroot"in t[n]&&t[n].isroot){var o=t[n],a=i._extract_data(o);return e.set_root(o.id,o.topic,a),t.splice(n,1),o.id}return null},_extract_subnode:function(e,t,i){var n=f.format.node_array,o=i.length,a=null,d=null,r=0;while(o--)if(a=i[o],a.parentid==t){d=n._extract_data(a);var s=null,l=a.direction;l&&(s="left"==l?f.direction.left:f.direction.right),e.add_node(t,a.id,a.topic,d,null,s,a.expanded),i.splice(o,1),r++;var h=n._extract_subnode(e,a.id,i);h>0&&(o=i.length,r+=h)}return r},_extract_data:function(e){var t={};for(var i in e)"id"!=i&&"topic"!=i&&"parentid"!=i&&"isroot"!=i&&"direction"!=i&&"expanded"!=i&&(t[i]=e[i]);return t},_array:function(e,t){var i=f.format.node_array;i._array_node(e.root,t)},_array_node:function(e,t){var i=f.format.node_array;if(e instanceof f.node){var n={id:e.id,topic:e.topic,expanded:e.expanded};if(e.parent&&(n.parentid=e.parent.id),e.isroot&&(n.isroot=!0),e.parent&&e.parent.isroot&&(n.direction=e.direction==f.direction.left?"left":"right"),null!=e.data){var o=e.data;for(var a in o)n[a]=o[a]}t.push(n);for(var d=e.children.length,r=0;r<d;r++)i._array_node(e.children[r],t)}}},freemind:{example:{meta:{name:i,author:o,version:n},format:"freemind",data:'<map version="1.0.1"><node ID="root" TEXT="freemind Example"/></map>'},get_mind:function(e){var t=f.format.freemind,i=new f.mind;i.name=e.meta.name,i.author=e.meta.author,i.version=e.meta.version;var n=e.data,o=t._parse_xml(n),a=t._find_root(o);return t._load_node(i,null,a),i},get_data:function(e){var t=f.format.freemind,i={};i.meta={name:e.name,author:e.author,version:e.version},i.format="freemind";var n=[];return n.push('<map version="1.0.1">'),t._buildmap(e.root,n),n.push("</map>"),i.data=n.join(" "),i},_parse_xml:function(e){var t=null;if(window.DOMParser){var i=new DOMParser;t=i.parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e);return t},_find_root:function(e){for(var t=e.childNodes,i=null,n=null,o=0;o<t.length;o++)if(n=t[o],1==n.nodeType&&"map"==n.tagName){i=n;break}if(i){var a=i.childNodes;i=null;for(o=0;o<a.length;o++)if(n=a[o],1==n.nodeType&&"node"==n.tagName){i=n;break}}return i},_load_node:function(e,t,i){var n=f.format.freemind,o=i.getAttribute("ID"),a=i.getAttribute("TEXT");if(null==a)for(var d=i.childNodes,r=null,s=0;s<d.length;s++)if(r=d[s],1==r.nodeType&&"richcontent"===r.tagName){a=r.textContent;break}var l=n._load_attributes(i),h=!("expanded"in l)||"true"==l.expanded;delete l.expanded;var c=i.getAttribute("POSITION"),u=null;c&&(u="left"==c?f.direction.left:f.direction.right),t?e.add_node(t,o,a,l,null,u,h):e.set_root(o,a,l);var _=i.childNodes,p=null;for(s=0;s<_.length;s++)p=_[s],1==p.nodeType&&"node"==p.tagName&&n._load_node(e,o,p)},_load_attributes:function(e){for(var t=e.childNodes,i=null,n={},o=0;o<t.length;o++)i=t[o],1==i.nodeType&&"attribute"===i.tagName&&(n[i.getAttribute("NAME")]=i.getAttribute("VALUE"));return n},_buildmap:function(e,t){var i=f.format.freemind,n=null;e.parent&&e.parent.isroot&&(n=e.direction===f.direction.left?"left":"right"),t.push("<node"),t.push('ID="'+e.id+'"'),n&&t.push('POSITION="'+n+'"'),t.push('TEXT="'+e.topic+'">'),t.push('<attribute NAME="expanded" VALUE="'+e.expanded+'"/>');var o=e.data;if(null!=o)for(var a in o)t.push('<attribute NAME="'+a+'" VALUE="'+o[a]+'"/>');for(var d=e.children,r=0;r<d.length;r++)i._buildmap(d[r],t);t.push("</node>")}}},f.util={is_node:function(e){return!!e&&e instanceof f.node},ajax:{_xhr:function(){var e=null;if(window.XMLHttpRequest)e=new XMLHttpRequest;else try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}return e},_eurl:function(e){return encodeURIComponent(e)},request:function(e,t,i,n,o){var a=f.util.ajax,r=null,s=[];for(var l in t)s.push(a._eurl(l)+"="+a._eurl(t[l]));s.length>0&&(r=s.join("&"));var h=a._xhr();h&&(h.onreadystatechange=function(){if(4==h.readyState)if(200==h.status||0==h.status){if("function"===typeof n){var e=f.util.json.string2json(h.responseText);n(null!=e?e:h.responseText)}}else"function"===typeof o?o(h):d.error("xhr request failed.",h)},i=i||"GET",h.open(i,e,!0),h.setRequestHeader("If-Modified-Since","0"),"POST"==i?(h.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),h.send(r)):h.send())},get:function(e,t){return f.util.ajax.request(e,{},"GET",t)},post:function(e,t,i){return f.util.ajax.request(e,t,"POST",i)}},dom:{add_event:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)}},canvas:{bezierto:function(e,t,i,n,o){e.beginPath(),e.moveTo(t,i),e.bezierCurveTo(t+2*(n-t)/3,i,t,o,n,o),e.stroke()},lineto:function(e,t,i,n,o){e.beginPath(),e.moveTo(t,i),e.lineTo(n,o),e.stroke()},clear:function(e,t,i,n,o){e.clearRect(t,i,n,o)}},file:{read:function(e,t){var i=new FileReader;i.onload=function(){"function"===typeof t&&t(this.result,e.name)},i.readAsText(e)},save:function(e,i,n){var o;if("function"===typeof t.Blob)o=new Blob([e],{type:i});else{var a=t.BlobBuilder||t.MozBlobBuilder||t.WebKitBlobBuilder||t.MSBlobBuilder,d=new a;d.append(e),o=d.getBlob(i)}if(navigator.msSaveBlob)navigator.msSaveBlob(o,n);else{var s=t.URL||t.webkitURL,h=s.createObjectURL(o),c=l("a");if("download"in c){c.style.visibility="hidden",c.href=h,c.download=n,r.body.appendChild(c);var u=r.createEvent("MouseEvents");u.initEvent("click",!0,!0),c.dispatchEvent(u),r.body.removeChild(c)}else location.href=h}}},json:{json2string:function(e){if(JSON)try{var t=JSON.stringify(e);return t}catch(e){return d.warn(e),d.warn("can not convert to string"),null}},string2json:function(e){if(JSON)try{var t=JSON.parse(e);return t}catch(e){return d.warn(e),d.warn("can not parse to json"),null}},merge:function(e,t){for(var i in t)i in e?"object"!==typeof e[i]||"[object object]"!=Object.prototype.toString.call(e[i]).toLowerCase()||e[i].length?e[i]=t[i]:f.util.json.merge(e[i],t[i]):e[i]=t[i];return e}},uuid:{newid:function(){return((new Date).getTime().toString(16)+Math.random().toString(16).substr(2)).substr(2,16)}},text:{is_empty:function(e){return!e||0==e.replace(/\s*/,"").length}}},f.prototype={init:function(){if(!this.inited){this.inited=!0;var e=this.options,t={mode:e.mode,hspace:e.layout.hspace,vspace:e.layout.vspace,pspace:e.layout.pspace},i={container:e.container,support_html:e.support_html,hmargin:e.view.hmargin,vmargin:e.view.vmargin,line_width:e.view.line_width,line_color:e.view.line_color};this.data=new f.data_provider(this),this.layout=new f.layout_provider(this,t),this.view=new f.view_provider(this,i),this.shortcut=new f.shortcut_provider(this,e.shortcut),this.data.init(),this.layout.init(),this.view.init(),this.shortcut.init(),this._event_bind(),f.init_plugins(this)}},enable_edit:function(){this.options.editable=!0},disable_edit:function(){this.options.editable=!1},enable_event_handle:function(e){this.options.default_event_handle["enable_"+e+"_handle"]=!0},disable_event_handle:function(e){this.options.default_event_handle["enable_"+e+"_handle"]=!1},get_editable:function(){return this.options.editable},set_theme:function(e){var t=this.options.theme;this.options.theme=e||null,t!=this.options.theme&&(this.view.reset_theme(),this.view.reset_custom_style())},_event_bind:function(){this.view.add_event(this,"mousedown",this.mousedown_handle),this.view.add_event(this,"click",this.click_handle),this.view.add_event(this,"dblclick",this.dblclick_handle)},mousedown_handle:function(e){if(this.options.default_event_handle["enable_mousedown_handle"]){var t=e.target||event.srcElement,i=this.view.get_binded_nodeid(t);i?this.select_node(i):this.select_clear()}},click_handle:function(e){if(this.options.default_event_handle["enable_click_handle"]){var t=e.target||event.srcElement,i=this.view.is_expander(t);if(i){var n=this.view.get_binded_nodeid(t);n&&this.toggle_node(n)}}},dblclick_handle:function(e){if(this.options.default_event_handle["enable_dblclick_handle"]&&this.get_editable()){var t=e.target||event.srcElement,i=this.view.get_binded_nodeid(t);i&&this.begin_edit(i)}},begin_edit:function(e){if(!f.util.is_node(e)){var t=this.get_node(e);return t?this.begin_edit(t):(d.error("the node[id="+e+"] can not be found."),!1)}this.get_editable()?this.view.edit_node_begin(e):d.error("fail, this mind map is not editable.")},end_edit:function(){this.view.edit_node_end()},toggle_node:function(e){if(!f.util.is_node(e)){var t=this.get_node(e);return t?this.toggle_node(t):void d.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.toggle_node(e),this.view.relayout(),this.view.restore_location(e))},expand_node:function(e){if(!f.util.is_node(e)){var t=this.get_node(e);return t?this.expand_node(t):void d.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.expand_node(e),this.view.relayout(),this.view.restore_location(e))},collapse_node:function(e){if(!f.util.is_node(e)){var t=this.get_node(e);return t?this.collapse_node(t):void d.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.collapse_node(e),this.view.relayout(),this.view.restore_location(e))},expand_all:function(){this.layout.expand_all(),this.view.relayout()},collapse_all:function(){this.layout.collapse_all(),this.view.relayout()},expand_to_depth:function(e){this.layout.expand_to_depth(e),this.view.relayout()},_reset:function(){this.view.reset(),this.layout.reset(),this.data.reset()},_show:function(e){var t=e||f.format.node_array.example;this.mind=this.data.load(t),this.mind?(d.debug("data.load ok"),this.view.load(),d.debug("view.load ok"),this.layout.layout(),d.debug("layout.layout ok"),this.view.show(!0),d.debug("view.show ok"),this.invoke_event_handle(f.event_type.show,{data:[e]})):d.error("data.load error")},show:function(e){this._reset(),this._show(e)},get_meta:function(){return{name:this.mind.name,author:this.mind.author,version:this.mind.version}},get_data:function(e){var t=e||"node_tree";return this.data.get_data(t)},get_root:function(){return this.mind.root},get_node:function(e){return this.mind.get_node(e)},add_node:function(e,t,i,n){if(this.get_editable()){var o=this.mind.add_node(e,t,i,n);return o&&(this.view.add_node(o),this.layout.layout(),this.view.show(!1),this.view.reset_node_custom_style(o),this.expand_node(e),this.invoke_event_handle(f.event_type.edit,{evt:"add_node",data:[e.id,t,i,n],node:t})),o}return d.error("fail, this mind map is not editable"),null},insert_node_before:function(e,t,i,n){if(this.get_editable()){var o=f.util.is_node(e)?e.id:e,a=this.mind.insert_node_before(e,t,i,n);return a&&(this.view.add_node(a),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(f.event_type.edit,{evt:"insert_node_before",data:[o,t,i,n],node:t})),a}return d.error("fail, this mind map is not editable"),null},insert_node_after:function(e,t,i,n){if(this.get_editable()){var o=f.util.is_node(e)?e.id:e,a=this.mind.insert_node_after(e,t,i,n);return a&&(this.view.add_node(a),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(f.event_type.edit,{evt:"insert_node_after",data:[o,t,i,n],node:t})),a}return d.error("fail, this mind map is not editable"),null},remove_node:function(e){if(!f.util.is_node(e)){var t=this.get_node(e);return t?this.remove_node(t):(d.error("the node[id="+e+"] can not be found."),!1)}if(this.get_editable()){if(e.isroot)return d.error("fail, can not remove root node"),!1;var i=e.id,n=e.parent.id,o=this.get_node(n);return this.view.save_location(o),this.view.remove_node(e),this.mind.remove_node(e),this.layout.layout(),this.view.show(!1),this.view.restore_location(o),this.invoke_event_handle(f.event_type.edit,{evt:"remove_node",data:[i],node:n}),!0}return d.error("fail, this mind map is not editable"),!1},update_node:function(e,t){if(this.get_editable())if(f.util.text.is_empty(t))d.warn("fail, topic can not be empty");else{var i=this.get_node(e);if(i){if(i.topic===t)return d.info("nothing changed"),void this.view.update_node(i);i.topic=t,this.view.update_node(i),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(f.event_type.edit,{evt:"update_node",data:[e,t],node:e})}}else d.error("fail, this mind map is not editable")},move_node:function(e,t,i,n){if(this.get_editable()){var o=this.mind.move_node(e,t,i,n);o&&(this.view.update_node(o),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(f.event_type.edit,{evt:"move_node",data:[e,t,i,n],node:e}))}else d.error("fail, this mind map is not editable")},select_node:function(e){if(!f.util.is_node(e)){var t=this.get_node(e);return t?this.select_node(t):void d.error("the node[id="+e+"] can not be found.")}this.layout.is_visible(e)&&(this.mind.selected=e,this.view.select_node(e))},get_selected_node:function(){return this.mind?this.mind.selected:null},select_clear:function(){this.mind&&(this.mind.selected=null,this.view.select_clear())},is_node_visible:function(e){return this.layout.is_visible(e)},find_node_before:function(e){if(!f.util.is_node(e)){var t=this.get_node(e);return t?this.find_node_before(t):void d.error("the node[id="+e+"] can not be found.")}if(e.isroot)return null;var i=null;if(e.parent.isroot)for(var n=e.parent.children,o=null,a=null,r=0;r<n.length;r++)a=n[r],e.direction===a.direction&&(e.id===a.id&&(i=o),o=a);else i=this.mind.get_node_before(e);return i},find_node_after:function(e){if(!f.util.is_node(e)){var t=this.get_node(e);return t?this.find_node_after(t):void d.error("the node[id="+e+"] can not be found.")}if(e.isroot)return null;var i=null;if(e.parent.isroot){for(var n=e.parent.children,o=!1,a=null,r=0;r<n.length;r++)if(a=n[r],e.direction===a.direction){if(o){i=a;break}e.id===a.id&&(o=!0)}}else i=this.mind.get_node_after(e);return i},set_node_color:function(e,t,i){if(!this.get_editable())return d.error("fail, this mind map is not editable"),null;var n=this.mind.get_node(e);n&&(t&&(n.data["background-color"]=t),i&&(n.data["foreground-color"]=i),this.view.reset_node_custom_style(n))},set_node_font_style:function(e,t,i,n){if(!this.get_editable())return d.error("fail, this mind map is not editable"),null;var o=this.mind.get_node(e);o&&(t&&(o.data["font-size"]=t),i&&(o.data["font-weight"]=i),n&&(o.data["font-style"]=n),this.view.reset_node_custom_style(o),this.view.update_node(o),this.layout.layout(),this.view.show(!1))},set_node_background_image:function(e,t,i,n,o){if(!this.get_editable())return d.error("fail, this mind map is not editable"),null;var a=this.mind.get_node(e);a&&(t&&(a.data["background-image"]=t),i&&(a.data["width"]=i),n&&(a.data["height"]=n),o&&(a.data["background-rotation"]=o),this.view.reset_node_custom_style(a),this.view.update_node(a),this.layout.layout(),this.view.show(!1))},set_node_background_rotation:function(e,t){if(!this.get_editable())return d.error("fail, this mind map is not editable"),null;var i=this.mind.get_node(e);if(i){if(!i.data["background-image"])return d.error("fail, only can change rotation angle of node with background image"),null;i.data["background-rotation"]=t,this.view.reset_node_custom_style(i),this.view.update_node(i),this.layout.layout(),this.view.show(!1)}},resize:function(){this.view.resize()},add_event_listener:function(e){"function"===typeof e&&this.event_handles.push(e)},invoke_event_handle:function(e,i){var n=this;t.setTimeout(function(){n._invoke_event_handle(e,i)},0)},_invoke_event_handle:function(e,t){for(var i=this.event_handles.length,n=0;n<i;n++)this.event_handles[n](e,t)}},f.data_provider=function(e){this.jm=e},f.data_provider.prototype={init:function(){d.debug("data.init")},reset:function(){d.debug("data.reset")},load:function(e){var t=null,i=null;return t="object"===typeof e?e.format?e.format:"node_tree":"freemind","node_array"==t?i=f.format.node_array.get_mind(e):"node_tree"==t?i=f.format.node_tree.get_mind(e):"freemind"==t?i=f.format.freemind.get_mind(e):d.warn("unsupported format"),i},get_data:function(e){var t=null;return"node_array"==e?t=f.format.node_array.get_data(this.jm.mind):"node_tree"==e?t=f.format.node_tree.get_data(this.jm.mind):"freemind"==e?t=f.format.freemind.get_data(this.jm.mind):d.error("unsupported "+e+" format"),t}},f.layout_provider=function(e,t){this.opts=t,this.jm=e,this.isside="side"==this.opts.mode,this.bounds=null,this.cache_valid=!1},f.layout_provider.prototype={init:function(){d.debug("layout.init")},reset:function(){d.debug("layout.reset"),this.bounds={n:0,s:0,w:0,e:0}},layout:function(){d.debug("layout.layout"),this.layout_direction(),this.layout_offset()},layout_direction:function(){this._layout_direction_root()},_layout_direction_root:function(){var e=this.jm.mind.root,t=null;"layout"in e._data?t=e._data.layout:(t={},e._data.layout=t);var i=e.children,n=i.length;if(t.direction=f.direction.center,t.side_index=0,this.isside){var o=n;while(o--)this._layout_direction_side(i[o],f.direction.right,o)}else{o=n;var a=null;while(o--)a=i[o],a.direction==f.direction.left?this._layout_direction_side(a,f.direction.left,o):this._layout_direction_side(a,f.direction.right,o)}},_layout_direction_side:function(e,t,i){var n=null;"layout"in e._data?n=e._data.layout:(n={},e._data.layout=n);var o=e.children,a=o.length;n.direction=t,n.side_index=i;var d=a;while(d--)this._layout_direction_side(o[d],t,d)},layout_offset:function(){var e=this.jm.mind.root,t=e._data.layout;t.offset_x=0,t.offset_y=0,t.outer_height=0;var i=e.children,n=i.length,o=[],a=[],d=null;while(n--)d=i[n],d._data.layout.direction==f.direction.right?a.unshift(d):o.unshift(d);t.left_nodes=o,t.right_nodes=a,t.outer_height_left=this._layout_offset_subnodes(o),t.outer_height_right=this._layout_offset_subnodes(a),this.bounds.e=e._data.view.width/2,this.bounds.w=0-this.bounds.e,this.bounds.n=0,this.bounds.s=Math.max(t.outer_height_left,t.outer_height_right)},_layout_offset_subnodes:function(e){var t=0,i=e.length,n=i,o=null,a=0,d=null,r=0,s=null;while(n--)o=e[n],d=o._data.layout,null==s&&(s=o.parent._data),a=this._layout_offset_subnodes(o.children),o.expanded||(a=0,this.set_visible(o.children,!1)),a=Math.max(o._data.view.height,a),d.outer_height=a,d.offset_y=r-a/2,d.offset_x=this.opts.hspace*d.direction+s.view.width*(s.layout.direction+d.direction)/2,o.parent.isroot||(d.offset_x+=this.opts.pspace*d.direction),r=r-a-this.opts.vspace,t+=a;i>1&&(t+=this.opts.vspace*(i-1)),n=i;var l=t/2;while(n--)o=e[n],o._data.layout.offset_y+=l;return t},_layout_offset_subnodes_height:function(e){var t=0,i=e.length,n=i,o=null,a=0,d=null,r=0,s=null;while(n--)o=e[n],d=o._data.layout,null==s&&(s=o.parent._data),a=this._layout_offset_subnodes_height(o.children),o.expanded||(a=0),a=Math.max(o._data.view.height,a),d.outer_height=a,d.offset_y=r-a/2,r=r-a-this.opts.vspace,t+=a;i>1&&(t+=this.opts.vspace*(i-1)),n=i;var l=t/2;while(n--)o=e[n],o._data.layout.offset_y+=l;return t},get_node_offset:function(e){var t=e._data.layout,i=null;if("_offset_"in t&&this.cache_valid?i=t._offset_:(i={x:-1,y:-1},t._offset_=i),-1==i.x||-1==i.y){var n=t.offset_x,o=t.offset_y;if(!e.isroot){var a=this.get_node_offset(e.parent);n+=a.x,o+=a.y}i.x=n,i.y=o}return i},get_node_point:function(e){var t=e._data.view,i=this.get_node_offset(e),n={};return n.x=i.x+t.width*(e._data.layout.direction-1)/2,n.y=i.y-t.height/2,n},get_node_point_in:function(e){var t=this.get_node_offset(e);return t},get_node_point_out:function(e){var t=e._data.layout,i=null;if("_pout_"in t&&this.cache_valid?i=t._pout_:(i={x:-1,y:-1},t._pout_=i),-1==i.x||-1==i.y)if(e.isroot)i.x=0,i.y=0;else{var n=e._data.view,o=this.get_node_offset(e);i.x=o.x+(n.width+this.opts.pspace)*e._data.layout.direction,i.y=o.y}return i},get_expander_point:function(e){var t=this.get_node_point_out(e),i={};return e._data.layout.direction==f.direction.right?i.x=t.x-this.opts.pspace:i.x=t.x,i.y=t.y-Math.ceil(this.opts.pspace/2),i},get_min_size:function(){var e=this.jm.mind.nodes,t=null,i=null;for(var n in e)t=e[n],i=this.get_node_point_out(t),i.x>this.bounds.e&&(this.bounds.e=i.x),i.x<this.bounds.w&&(this.bounds.w=i.x);return{w:this.bounds.e-this.bounds.w,h:this.bounds.s-this.bounds.n}},toggle_node:function(e){e.isroot||(e.expanded?this.collapse_node(e):this.expand_node(e))},expand_node:function(e){e.expanded=!0,this.part_layout(e),this.set_visible(e.children,!0)},collapse_node:function(e){e.expanded=!1,this.part_layout(e),this.set_visible(e.children,!1)},expand_all:function(){var e,t=this.jm.mind.nodes,i=0;for(var n in t)e=t[n],e.expanded||(e.expanded=!0,i++);if(i>0){var o=this.jm.mind.root;this.part_layout(o),this.set_visible(o.children,!0)}},collapse_all:function(){var e,t=this.jm.mind.nodes,i=0;for(var n in t)e=t[n],e.expanded&&!e.isroot&&(e.expanded=!1,i++);if(i>0){var o=this.jm.mind.root;this.part_layout(o),this.set_visible(o.children,!0)}},expand_to_depth:function(e,t,i){if(!(e<1)){var n=t||this.jm.mind.root.children,o=i||1,a=n.length,d=null;while(a--)d=n[a],o<e&&(d.expanded||this.expand_node(d),this.expand_to_depth(e,d.children,o+1)),o==e&&d.expanded&&this.collapse_node(d)}},part_layout:function(e){var t=this.jm.mind.root;if(t){var i=t._data.layout;e.isroot?(i.outer_height_right=this._layout_offset_subnodes_height(i.right_nodes),i.outer_height_left=this._layout_offset_subnodes_height(i.left_nodes)):e._data.layout.direction==f.direction.right?i.outer_height_right=this._layout_offset_subnodes_height(i.right_nodes):i.outer_height_left=this._layout_offset_subnodes_height(i.left_nodes),this.bounds.s=Math.max(i.outer_height_left,i.outer_height_right),this.cache_valid=!1}else d.warn("can not found root node")},set_visible:function(e,t){var i=e.length,n=null;while(i--)n=e[i],n._data.layout,n.expanded?this.set_visible(n.children,t):this.set_visible(n.children,!1),n.isroot||(n._data.layout.visible=t)},is_expand:function(e){return e.expanded},is_visible:function(e){var t=e._data.layout;return!("visible"in t&&!t.visible)}},f.view_provider=function(e,t){this.opts=t,this.jm=e,this.layout=e.layout,this.container=null,this.e_panel=null,this.e_nodes=null,this.e_canvas=null,this.canvas_ctx=null,this.size={w:0,h:0},this.selected_node=null,this.editing_node=null},f.view_provider.prototype={init:function(){if(d.debug("view.init"),this.container=u(this.opts.container)?this.opts.container:s(this.opts.container),this.container){this.e_panel=l("div"),this.e_canvas=l("canvas"),this.e_nodes=l("jmnodes"),this.e_editor=l("input"),this.e_panel.className="jsmind-inner",this.e_panel.appendChild(this.e_canvas),this.e_panel.appendChild(this.e_nodes),this.e_editor.className="jsmind-editor",this.e_editor.type="text",this.actualZoom=1,this.zoomStep=.1,this.minZoom=.5,this.maxZoom=2;var e=this;f.util.dom.add_event(this.e_editor,"keydown",function(t){var i=t||event;13==i.keyCode&&(e.edit_node_end(),i.stopPropagation())}),f.util.dom.add_event(this.e_editor,"blur",function(t){e.edit_node_end()}),this.container.appendChild(this.e_panel),this.init_canvas()}else d.error("the options.view.container was not be found in dom")},add_event:function(e,t,i){f.util.dom.add_event(this.e_nodes,t,function(t){var n=t||event;i.call(e,n)})},get_binded_nodeid:function(e){if(null==e)return null;var t=e.tagName.toLowerCase();return"jmnodes"==t||"body"==t||"html"==t?null:"jmnode"==t||"jmexpander"==t?e.getAttribute("nodeid"):this.get_binded_nodeid(e.parentElement)},is_expander:function(e){return"jmexpander"==e.tagName.toLowerCase()},reset:function(){d.debug("view.reset"),this.selected_node=null,this.clear_lines(),this.clear_nodes(),this.reset_theme()},reset_theme:function(){var e=this.jm.options.theme;this.e_nodes.className=e?"theme-"+e:""},reset_custom_style:function(){var e=this.jm.mind.nodes;for(var t in e)this.reset_node_custom_style(e[t])},load:function(){d.debug("view.load"),this.init_nodes()},expand_size:function(){var e=this.layout.get_min_size(),t=e.w+2*this.opts.hmargin,i=e.h+2*this.opts.vmargin,n=this.e_panel.clientWidth,o=this.e_panel.clientHeight;n<t&&(n=t),o<i&&(o=i),this.size.w=n,this.size.h=o},init_canvas:function(){var e=this.e_canvas.getContext("2d");this.canvas_ctx=e},init_nodes_size:function(e){var t=e._data.view;t.width=t.element.clientWidth,t.height=t.element.clientHeight},init_nodes:function(){var e=this.jm.mind.nodes,t=r.createDocumentFragment();for(var i in e)this.create_node_element(e[i],t);for(var i in this.e_nodes.appendChild(t),e)this.init_nodes_size(e[i])},add_node:function(e){this.create_node_element(e,this.e_nodes),this.init_nodes_size(e)},create_node_element:function(e,t){var i=null;"view"in e._data?i=e._data.view:(i={},e._data.view=i);var n=l("jmnode");if(e.isroot)n.className="root";else{var o=l("jmexpander");h(o,"-"),o.setAttribute("nodeid",e.id),o.style.visibility="hidden",t.appendChild(o),i.expander=o}e.topic&&(this.opts.support_html?c(n,e.topic):h(n,e.topic)),n.setAttribute("nodeid",e.id),n.style.visibility="hidden",this._reset_node_custom_style(n,e.data),t.appendChild(n),i.element=n},remove_node:function(e){null!=this.selected_node&&this.selected_node.id==e.id&&(this.selected_node=null),null!=this.editing_node&&this.editing_node.id==e.id&&(e._data.view.element.removeChild(this.e_editor),this.editing_node=null);var t=e.children,i=t.length;while(i--)this.remove_node(t[i]);if(e._data.view){var n=e._data.view.element,o=e._data.view.expander;this.e_nodes.removeChild(n),this.e_nodes.removeChild(o),e._data.view.element=null,e._data.view.expander=null}},update_node:function(e){var t=e._data.view,i=t.element;e.topic&&(this.opts.support_html?c(i,e.topic):h(i,e.topic)),t.width=i.clientWidth,t.height=i.clientHeight},select_node:function(e){this.selected_node&&(this.selected_node._data.view.element.className=this.selected_node._data.view.element.className.replace(/\s*selected\b/i,""),this.reset_node_custom_style(this.selected_node)),e&&(this.selected_node=e,e._data.view.element.className+=" selected",this.clear_node_custom_style(e))},select_clear:function(){this.select_node(null)},get_editing_node:function(){return this.editing_node},is_editing:function(){return!!this.editing_node},edit_node_begin:function(e){if(e.topic){null!=this.editing_node&&this.edit_node_end(),this.editing_node=e;var t=e._data.view,i=t.element,n=e.topic,o=getComputedStyle(i);this.e_editor.value=n,this.e_editor.style.width=i.clientWidth-parseInt(o.getPropertyValue("padding-left"))-parseInt(o.getPropertyValue("padding-right"))+"px",i.innerHTML="",i.appendChild(this.e_editor),i.style.zIndex=5,this.e_editor.focus(),this.e_editor.select()}else d.warn("don't edit image nodes")},edit_node_end:function(){if(null!=this.editing_node){var e=this.editing_node;this.editing_node=null;var t=e._data.view,i=t.element,n=this.e_editor.value;i.style.zIndex="auto",i.removeChild(this.e_editor),f.util.text.is_empty(n)||e.topic===n?this.opts.support_html?c(i,e.topic):h(i,e.topic):this.jm.update_node(e.id,n)}},get_view_offset:function(){var e=this.layout.bounds,t=(this.size.w-e.e-e.w)/2,i=this.size.h/2;return{x:t,y:i}},resize:function(){this.e_canvas.width=1,this.e_canvas.height=1,this.e_nodes.style.width="1px",this.e_nodes.style.height="1px",this.expand_size(),this._show()},_show:function(){this.e_canvas.width=this.size.w,this.e_canvas.height=this.size.h,this.e_nodes.style.width=this.size.w+"px",this.e_nodes.style.height=this.size.h+"px",this.show_nodes(),this.show_lines(),this.jm.invoke_event_handle(f.event_type.resize,{data:[]})},zoomIn:function(){return this.setZoom(this.actualZoom+this.zoomStep)},zoomOut:function(){return this.setZoom(this.actualZoom-this.zoomStep)},setZoom:function(e){if(e<this.minZoom||e>this.maxZoom)return!1;this.actualZoom=e;for(var t=0;t<this.e_panel.children.length;t++)this.e_panel.children[t].style.transform="scale("+e+")";return this.show(!0),!0},_center_root:function(){var e=this.e_panel.clientWidth,t=this.e_panel.clientHeight;if(this.size.w>e){var i=this.get_view_offset();this.e_panel.scrollLeft=i.x-e/2}this.size.h>t&&(this.e_panel.scrollTop=(this.size.h-t)/2)},show:function(e){d.debug("view.show"),this.expand_size(),this._show(),e&&this._center_root()},relayout:function(){this.expand_size(),this._show()},save_location:function(e){var t=e._data.view;t._saved_location={x:parseInt(t.element.style.left)-this.e_panel.scrollLeft,y:parseInt(t.element.style.top)-this.e_panel.scrollTop}},restore_location:function(e){var t=e._data.view;this.e_panel.scrollLeft=parseInt(t.element.style.left)-t._saved_location.x,this.e_panel.scrollTop=parseInt(t.element.style.top)-t._saved_location.y},clear_nodes:function(){var e=this.jm.mind;if(null!=e){var t=e.nodes,i=null;for(var n in t)i=t[n],i._data.view.element=null,i._data.view.expander=null;this.e_nodes.innerHTML=""}},show_nodes:function(){var e=this.jm.mind.nodes,t=null,i=null,n=null,o=null,a=null,d="-",r=null,s=this.get_view_offset();for(var l in e)t=e[l],r=t._data.view,i=r.element,n=r.expander,this.layout.is_visible(t)?(this.reset_node_custom_style(t),o=this.layout.get_node_point(t),r.abs_x=s.x+o.x,r.abs_y=s.y+o.y,i.style.left=s.x+o.x+"px",i.style.top=s.y+o.y+"px",i.style.display="",i.style.visibility="visible",!t.isroot&&t.children.length>0&&(d=t.expanded?"-":"+",a=this.layout.get_expander_point(t),n.style.left=s.x+a.x+"px",n.style.top=s.y+a.y+"px",n.style.display="",n.style.visibility="visible",h(n,d)),t.isroot||0!=t.children.length||(n.style.display="none",n.style.visibility="hidden")):(i.style.display="none",n.style.display="none")},reset_node_custom_style:function(e){this._reset_node_custom_style(e._data.view.element,e.data)},_reset_node_custom_style:function(e,t){if("background-color"in t&&(e.style.backgroundColor=t["background-color"]),"foreground-color"in t&&(e.style.color=t["foreground-color"]),"width"in t&&(e.style.width=t["width"]+"px"),"height"in t&&(e.style.height=t["height"]+"px"),"font-size"in t&&(e.style.fontSize=t["font-size"]+"px"),"font-weight"in t&&(e.style.fontWeight=t["font-weight"]),"font-style"in t&&(e.style.fontStyle=t["font-style"]),"background-image"in t){var i=t["background-image"];if(i.startsWith("data")&&t["width"]&&t["height"]){var n=new Image;n.onload=function(){var t=l("canvas");t.width=e.clientWidth,t.height=e.clientHeight;var i=this;if(t.getContext){var n=t.getContext("2d");n.drawImage(i,2,2,e.clientWidth,e.clientHeight);var o=t.toDataURL();e.style.backgroundImage="url("+o+")"}},n.src=i}else e.style.backgroundImage="url("+i+")";e.style.backgroundSize="99%","background-rotation"in t&&(e.style.transform="rotate("+t["background-rotation"]+"deg)")}},clear_node_custom_style:function(e){var t=e._data.view.element;t.style.backgroundColor="",t.style.color=""},clear_lines:function(e){var t=e||this.canvas_ctx;f.util.canvas.clear(t,0,0,this.size.w,this.size.h)},show_lines:function(e){this.clear_lines(e);var t=this.jm.mind.nodes,i=null,n=null,o=null,a=this.get_view_offset();for(var d in t)i=t[d],i.isroot||"visible"in i._data.layout&&!i._data.layout.visible||(n=this.layout.get_node_point_in(i),o=this.layout.get_node_point_out(i.parent),this.draw_line(o,n,a,e))},draw_line:function(e,t,i,n){var o=n||this.canvas_ctx;o.strokeStyle=this.opts.line_color,o.lineWidth=this.opts.line_width,o.lineCap="round",f.util.canvas.bezierto(o,e.x+i.x,e.y+i.y,t.x+i.x,t.y+i.y)}},f.shortcut_provider=function(e,t){this.jm=e,this.opts=t,this.mapping=t.mapping,this.handles=t.handles,this._mapping={}},f.shortcut_provider.prototype={init:function(){for(var e in f.util.dom.add_event(r,"keydown",this.handler.bind(this)),this.handles["addchild"]=this.handle_addchild,this.handles["addbrother"]=this.handle_addbrother,this.handles["editnode"]=this.handle_editnode,this.handles["delnode"]=this.handle_delnode,this.handles["toggle"]=this.handle_toggle,this.handles["up"]=this.handle_up,this.handles["down"]=this.handle_down,this.handles["left"]=this.handle_left,this.handles["right"]=this.handle_right,this.mapping)this.mapping[e]&&e in this.handles&&(this._mapping[this.mapping[e]]=this.handles[e])},enable_shortcut:function(){this.opts.enable=!0},disable_shortcut:function(){this.opts.enable=!1},handler:function(e){if(!this.jm.view.is_editing()){var t=e||event;if(!this.opts.enable)return!0;var i=t.keyCode;i in this._mapping&&this._mapping[i].call(this,this.jm,e)}},handle_addchild:function(e,t){var i=e.get_selected_node();if(i){var n=f.util.uuid.newid(),o=e.add_node(i,n,"New Node");o&&(e.select_node(n),e.begin_edit(n))}},handle_addbrother:function(e,t){var i=e.get_selected_node();if(i&&!i.isroot){var n=f.util.uuid.newid(),o=e.insert_node_after(i,n,"New Node");o&&(e.select_node(n),e.begin_edit(n))}},handle_editnode:function(e,t){var i=e.get_selected_node();i&&e.begin_edit(i)},handle_delnode:function(e,t){var i=e.get_selected_node();i&&!i.isroot&&(e.select_node(i.parent),e.remove_node(i))},handle_toggle:function(e,t){var i=t||event,n=e.get_selected_node();n&&(e.toggle_node(n.id),i.stopPropagation(),i.preventDefault())},handle_up:function(e,t){var i=t||event,n=e.get_selected_node();if(n){var o=e.find_node_before(n);if(!o){var a=e.find_node_before(n.parent);a&&a.children.length>0&&(o=a.children[a.children.length-1])}o&&e.select_node(o),i.stopPropagation(),i.preventDefault()}},handle_down:function(e,t){var i=t||event,n=e.get_selected_node();if(n){var o=e.find_node_after(n);if(!o){var a=e.find_node_after(n.parent);a&&a.children.length>0&&(o=a.children[0])}o&&e.select_node(o),i.stopPropagation(),i.preventDefault()}},handle_left:function(e,t){this._handle_direction(e,t,f.direction.left)},handle_right:function(e,t){this._handle_direction(e,t,f.direction.right)},_handle_direction:function(e,t,i){var n=t||event,o=e.get_selected_node(),a=null;if(o){if(o.isroot){for(var d=o.children,r=[],s=0;s<d.length;s++)d[s].direction===i&&r.push(s);a=d[r[Math.floor((r.length-1)/2)]]}else if(o.direction===i){r=o.children;var l=r.length;l>0&&(a=r[Math.floor((l-1)/2)])}else a=o.parent;a&&e.select_node(a),n.stopPropagation(),n.preventDefault()}}},f.plugin=function(e,t){this.name=e,this.init=t},f.plugins=[],f.register_plugin=function(e){e instanceof f.plugin&&f.plugins.push(e)},f.init_plugins=function(e){t.setTimeout(function(){f._init_plugins(e)},0)},f._init_plugins=function(e){for(var t=f.plugins.length,i=null,n=0;n<t;n++)i=f.plugins[n].init,"function"===typeof i&&i(e)},f.show=function(e,t){var i=new f(e);return i.show(t),i},e.exports=f}else d.log(i+" has been already exist.")})("undefined"!==typeof window?window:t)}).call(this,i("c8ba"))},"6e2c":function(e,t,i){},7652:function(e,t,i){"use strict";var n=i("eaa8"),o=i.n(n);o.a},eaa8:function(e,t,i){}}]);